<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	작성일 : 2024.07.15
	작성자 : 김준식
	내용 : 화원가입 입니다.
 -->
<mapper namespace="SmartLicense.smartlicense.SignInUp.Dao.MemberDao">
    <!--
	작성일 : 2024.07.15
	작성자 : 김준식
	내용 : 아이디 중복 확인
    -->
    <select id="isDuplicateId" parameterType="HashMap" resultType="int">
        SELECT COUNT(member_id)
        FROM member
        WHERE member_id = #{userid}
    </select>

    <!--
	작성일 : 2024.07.15
	작성자 : 김준식
	내용 : 닉네임 중복 확인
    -->
    <select id="isDuplicateNickName" parameterType="HashMap" resultType="int">
        SELECT COUNT(member_nickname)
        FROM member
        WHERE member_nickname = #{nickname}
    </select>

    <!--
	작성일 : 2024.07.15
	작성자 : 김준식
	내용 : 아이디, 비밀번호, 이름, 닉네임, 성별 등 저장
    -->
    <insert id="memberRegister" parameterType="SmartLicense.smartlicense.SignInUp.DTO.MemberDTO" >
        INSERT INTO member( member_id, member_password, member_name, member_phone_number, member_nickname, member_gender)
        VALUES (#{userid}, #{pw}, #{name}, #{phonenumber}, #{nickname}, #{gender})
    </insert>

    <!--
	작성일 : 2024.07.29
	작성자 : 김준식
	내용 : 마이페이지에서 회원정보(이름, 닉네임, 오늘 푼 총 문제수, 오늘 푼 문제에 대한 정답 갯수)
    -->
    <select id="loadUserInfo" parameterType="HashMap" resultType="HashMap">
        SELECT m.member_name as member_name,
               m.member_nickname as member_nickname,
               COUNT(usa.user_select_answer_idx) as total_count,
               SUM(usa.is_correct) as correct_count
        FROM member m
                 JOIN user_select_answer usa ON m.member_id = usa.member_id
        WHERE m.member_id = #{member_id}
          AND usa.start_test_date LIKE CONCAT(#{current_date}, '%')
    </select>


</mapper>